<Page x:Class="CORCleanup.Views.NetworkPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      Title="Network"
      Background="{DynamicResource ApplicationBackgroundBrush}">

    <DockPanel Margin="12,0,12,8">
        <!-- Section Header -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,8,0,6">
            <Border Width="4" Height="18" CornerRadius="2"
                    Background="{StaticResource CorSectionNetworkBrush}" Margin="0,0,8,0" VerticalAlignment="Center" />
            <TextBlock Text="Network" FontSize="16" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextFillColorPrimaryBrush}" VerticalAlignment="Center" />
        </StackPanel>
        <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0"
                    SelectedIndex="{Binding ViewModel.SelectedTabIndex}">

            <!-- ============================================================ -->
            <!-- TAB 1: Continuous Ping -->
            <!-- ============================================================ -->
            <TabItem Header="Ping">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Ping controls -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBox Grid.Column="0"
                                    PlaceholderText="IP address or hostname (e.g. 8.8.8.8)"
                                    Text="{Binding ViewModel.PingTarget, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0" />
                        <ui:Button Grid.Column="1"
                                   Content="Start"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.StartPingCommand}"
                                   Margin="0,0,4,0" MinWidth="80" />
                        <ui:Button Grid.Column="2"
                                   Content="Stop"
                                   Appearance="Danger"
                                   Command="{Binding ViewModel.StopPingCommand}"
                                   MinWidth="80" />
                    </Grid>

                    <!-- Statistics -->
                    <ui:Card Grid.Row="1" Margin="0,0,0,12" Padding="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock Text="Sent" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.TotalSent}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="Received" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.TotalReceived}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock Text="Lost" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.TotalLost}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                <TextBlock Text="Loss %" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.LossPercentage, StringFormat={}{0:F1}%}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                <TextBlock Text="Min (ms)" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.MinMs}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="5" HorizontalAlignment="Center">
                                <TextBlock Text="Max (ms)" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.MaxMs}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="6" HorizontalAlignment="Center">
                                <TextBlock Text="Avg (ms)" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.AvgMs, StringFormat={}{0:F1}}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </ui:Card>

                    <!-- Ping results table -->
                    <DataGrid Grid.Row="2"
                              ItemsSource="{Binding ViewModel.PingResults}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding Timestamp, StringFormat=HH:mm:ss.fff}" Width="120" />
                            <DataGridTextColumn Header="Target" Binding="{Binding Target}" Width="180" />
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120" />
                            <DataGridTextColumn Header="RTT (ms)" Binding="{Binding RoundtripMs}" Width="100" />
                            <DataGridTextColumn Header="TTL" Binding="{Binding Ttl}" Width="80" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 2: Traceroute -->
            <!-- ============================================================ -->
            <TabItem Header="Traceroute">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Trace controls -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBox Grid.Column="0"
                                    PlaceholderText="Target host (e.g. google.co.uk)"
                                    Text="{Binding ViewModel.TraceTarget, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0" />
                        <ui:Button Grid.Column="1"
                                   Content="Trace"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.StartTraceCommand}"
                                   Margin="0,0,4,0" MinWidth="80" />
                        <ui:Button Grid.Column="2"
                                   Content="Stop"
                                   Appearance="Danger"
                                   Command="{Binding ViewModel.StopTraceCommand}"
                                   MinWidth="80" />
                    </Grid>

                    <!-- Trace status -->
                    <TextBlock Grid.Row="1"
                               Text="{Binding ViewModel.TraceStatus}"
                               Visibility="{Binding ViewModel.TraceStatus, Converter={StaticResource StringToVis}}"
                               Opacity="0.7" Margin="0,0,0,8" />

                    <!-- Trace results -->
                    <DataGrid Grid.Row="2"
                              ItemsSource="{Binding ViewModel.TraceHops}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Hop" Binding="{Binding HopNumber}" Width="50" />
                            <DataGridTextColumn Header="Address" Binding="{Binding DisplayAddress}" Width="*" />
                            <DataGridTextColumn Header="RTT 1" Binding="{Binding RoundtripMs1, StringFormat={}{0}ms}" Width="80" />
                            <DataGridTextColumn Header="RTT 2" Binding="{Binding RoundtripMs2, StringFormat={}{0}ms}" Width="80" />
                            <DataGridTextColumn Header="RTT 3" Binding="{Binding RoundtripMs3, StringFormat={}{0}ms}" Width="80" />
                            <DataGridTextColumn Header="Avg" Binding="{Binding AvgMs, StringFormat={}{0}ms}" Width="70" />
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80" />
                        </DataGrid.Columns>

                        <!-- Colour-code slow hops and timeouts -->
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="Slow">
                                        <Setter Property="Foreground" Value="#D4A843" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Timeout">
                                        <Setter Property="Foreground" Value="#E06666" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 3: DNS Lookup -->
            <!-- ============================================================ -->
            <TabItem Header="DNS Lookup">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Domain input + record type + server selection -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="200" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBox Grid.Column="0"
                                    PlaceholderText="Domain name (e.g. example.co.uk)"
                                    Text="{Binding ViewModel.DnsDomain, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0" />
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding ViewModel.DnsRecordTypes}"
                                  SelectedIndex="{Binding ViewModel.DnsRecordTypeIndex}"
                                  Margin="0,0,8,0" />
                        <ComboBox Grid.Column="2"
                                  ItemsSource="{Binding ViewModel.DnsServerOptions}"
                                  SelectedIndex="{Binding ViewModel.DnsServerIndex}" />
                    </Grid>

                    <!-- Custom DNS server input (visible when "Custom" selected) -->
                    <ui:TextBox Grid.Row="1"
                                PlaceholderText="Custom DNS server IP"
                                Text="{Binding ViewModel.DnsCustomServer, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,12"
                                Visibility="{Binding ViewModel.DnsServerIndex, Converter={StaticResource IntEqualsToVis}, ConverterParameter=5}" />

                    <!-- Action buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,12">
                        <ui:Button Content="Lookup"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.DnsLookupCommand}"
                                   Margin="0,0,8,0" MinWidth="100" />
                        <ui:Button Content="Propagation Check"
                                   Command="{Binding ViewModel.DnsPropagationCheckCommand}"
                                   Margin="0,0,16,0" MinWidth="140" />
                        <TextBlock Text="{Binding ViewModel.DnsStatus}"
                                   VerticalAlignment="Center" Opacity="0.7" />
                    </StackPanel>

                    <!-- DNS results -->
                    <DataGrid Grid.Row="3"
                              ItemsSource="{Binding ViewModel.DnsRecords}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="70" />
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="250" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*" />
                            <DataGridTextColumn Header="TTL" Binding="{Binding Ttl}" Width="80" />
                            <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="80" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 4: Port Scanner -->
            <!-- ============================================================ -->
            <TabItem Header="Ports">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TabControl Grid.Row="1"
                                SelectedIndex="{Binding ViewModel.PortScanTabIndex}">

                        <!-- Remote Port Scan -->
                        <TabItem Header="Remote Scan">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <!-- Host + Preset -->
                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="180" />
                                    </Grid.ColumnDefinitions>

                                    <ui:TextBox Grid.Column="0"
                                                PlaceholderText="Target host (IP or domain)"
                                                Text="{Binding ViewModel.PortScanHost, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding ViewModel.PortPresets}"
                                              SelectedIndex="{Binding ViewModel.PortPresetIndex}" />
                                </Grid>

                                <!-- Port range (visible when Custom preset) -->
                                <ui:TextBox Grid.Row="1"
                                            PlaceholderText="Ports: 80,443,22 or 1-1024"
                                            Text="{Binding ViewModel.PortScanRange, UpdateSourceTrigger=PropertyChanged}"
                                            Margin="0,0,0,8" />

                                <!-- Buttons + status -->
                                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,8">
                                    <ui:Button Content="Scan"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.StartPortScanCommand}"
                                               Margin="0,0,8,0" MinWidth="80" />
                                    <ui:Button Content="Stop"
                                               Appearance="Danger"
                                               Command="{Binding ViewModel.StopPortScanCommand}"
                                               Visibility="{Binding ViewModel.IsPortScanning, Converter={StaticResource BoolToVis}}"
                                               Margin="0,0,16,0" MinWidth="70" />
                                    <TextBlock Text="{Binding ViewModel.PortScanStatus}"
                                               VerticalAlignment="Center" Opacity="0.7" />
                                </StackPanel>

                                <!-- Port scan results -->
                                <DataGrid Grid.Row="3"
                                          ItemsSource="{Binding ViewModel.PortScanResults}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Port" Binding="{Binding PortDisplay}" Width="100" />
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80" />
                                        <DataGridTextColumn Header="Service" Binding="{Binding ServiceName}" Width="150" />
                                        <DataGridTextColumn Header="Response (ms)" Binding="{Binding ResponseTimeMs}" Width="120" />
                                        <DataGridTextColumn Header="Host" Binding="{Binding Host}" Width="*" />
                                    </DataGrid.Columns>

                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsOpen}" Value="True">
                                                    <Setter Property="Foreground" Value="#7DBF8E" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsOpen}" Value="False">
                                                    <Setter Property="Foreground" Value="#E06666" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>
                                </DataGrid>
                            </Grid>
                        </TabItem>

                        <!-- Local Ports (TCPView style) -->
                        <TabItem Header="Local Ports">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                    <ui:Button Content="Load Local Ports"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.LoadLocalPortsCommand}"
                                               MinWidth="130" Margin="0,0,16,0" />
                                    <TextBlock Text="{Binding ViewModel.PortScanStatus}"
                                               VerticalAlignment="Center" Opacity="0.7" />
                                </StackPanel>

                                <DataGrid Grid.Row="1"
                                          ItemsSource="{Binding ViewModel.LocalPorts}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Protocol" Binding="{Binding Protocol}" Width="70" />
                                        <DataGridTextColumn Header="Local" Binding="{Binding LocalEndpoint}" Width="180" />
                                        <DataGridTextColumn Header="Remote" Binding="{Binding RemoteEndpoint}" Width="180" />
                                        <DataGridTextColumn Header="State" Binding="{Binding State}" Width="120" />
                                        <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="70" />
                                        <DataGridTextColumn Header="Process" Binding="{Binding ProcessName}" Width="*" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 5: Quick Network Info -->
            <!-- ============================================================ -->
            <TabItem Header="Network Info">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                        <ui:Button Content="Refresh"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.LoadNetworkInfoCommand}"
                                   MinWidth="100" Margin="0,0,16,0" />
                        <TextBlock VerticalAlignment="Center" Opacity="0.7">
                            <Run Text="Public IP: " />
                            <Run Text="{Binding ViewModel.PublicIp}" FontWeight="SemiBold" />
                        </TextBlock>
                    </StackPanel>

                    <!-- Adapters table -->
                    <DataGrid Grid.Row="2"
                              ItemsSource="{Binding ViewModel.Adapters}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150" />
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80" />
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="70" />
                            <DataGridTextColumn Header="IP Address" Binding="{Binding IpAddress}" Width="130" />
                            <DataGridTextColumn Header="Subnet" Binding="{Binding SubnetMask}" Width="130" />
                            <DataGridTextColumn Header="Gateway" Binding="{Binding Gateway}" Width="130" />
                            <DataGridTextColumn Header="DNS" Binding="{Binding DnsDisplay}" Width="200" />
                            <DataGridTextColumn Header="MAC" Binding="{Binding MacAddress}" Width="140" />
                            <DataGridTextColumn Header="Speed" Binding="{Binding SpeedDisplay}" Width="100" />
                        </DataGrid.Columns>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="Up">
                                        <Setter Property="Foreground" Value="#7DBF8E" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Down">
                                        <Setter Property="Foreground" Value="#888888" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 6: Subnet Calculator -->
            <!-- ============================================================ -->
            <TabItem Header="Subnet Calc">
                <ScrollViewer Margin="16" VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <!-- CIDR Calculator -->
                        <ui:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="CIDR Calculator"
                                           FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12" />

                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <ui:TextBox Grid.Column="0"
                                                PlaceholderText="IP/CIDR (e.g. 192.168.1.0/24)"
                                                Text="{Binding ViewModel.SubnetInput, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:Button Grid.Column="1"
                                               Content="Calculate"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.CalculateSubnetCommand}"
                                               MinWidth="100" />
                                </Grid>

                                <!-- Error display -->
                                <TextBlock Text="{Binding ViewModel.SubnetError}"
                                           Foreground="#E06666"
                                           Visibility="{Binding ViewModel.SubnetError, Converter={StaticResource StringToVis}}"
                                           Margin="0,0,0,8" />

                                <!-- Results -->
                                <Grid Visibility="{Binding ViewModel.SubnetResult, Converter={StaticResource NullToVis}}"
                                      Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Network Address:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.NetworkAddress}" Margin="0,2" />

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Broadcast:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.BroadcastAddress}" Margin="0,2" />

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Subnet Mask:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.SubnetMask}" Margin="0,2" />

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Wildcard Mask:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.WildcardMask}" Margin="0,2" />

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Host Range:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.HostRange}" Margin="0,2" />

                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Usable Hosts:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding ViewModel.SubnetResult.TotalDisplay}" Margin="0,2" />

                                    <TextBlock Grid.Row="6" Grid.Column="0" Text="CIDR Notation:" FontWeight="SemiBold" Margin="0,2" />
                                    <TextBlock Grid.Row="6" Grid.Column="1" Margin="0,2">
                                        <Run Text="/" /><Run Text="{Binding ViewModel.SubnetResult.CidrNotation}" />
                                    </TextBlock>
                                </Grid>
                            </StackPanel>
                        </ui:Card>

                        <!-- Same Subnet Check -->
                        <ui:Card Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Same Subnet Check"
                                           FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12" />

                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <ui:TextBox Grid.Column="0"
                                                PlaceholderText="IP Address 1"
                                                Text="{Binding ViewModel.SubnetIp1, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:TextBox Grid.Column="1"
                                                PlaceholderText="IP Address 2"
                                                Text="{Binding ViewModel.SubnetIp2, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:TextBox Grid.Column="2"
                                                PlaceholderText="Subnet Mask"
                                                Text="{Binding ViewModel.SubnetMaskInput, UpdateSourceTrigger=PropertyChanged}"
                                                Margin="0,0,8,0" />
                                    <ui:Button Grid.Column="3"
                                               Content="Check"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.CheckSameSubnetCommand}"
                                               MinWidth="80" />
                                </Grid>

                                <TextBlock Text="{Binding ViewModel.SameSubnetResult}"
                                           Visibility="{Binding ViewModel.SameSubnetResult, Converter={StaticResource StringToVis}}"
                                           FontWeight="SemiBold" Margin="0,4,0,0" />
                            </StackPanel>
                        </ui:Card>

                        <!-- Common subnets reference -->
                        <ui:Card Padding="16">
                            <StackPanel>
                                <TextBlock Text="Common Subnets Reference"
                                           FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12" />

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="CIDR" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="1" Text="Mask" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="2" Text="Hosts" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="3" Text="Class" FontWeight="SemiBold" />
                                </Grid>

                                <!-- /24 -->
                                <Grid Margin="0,4,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/24" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.0" />
                                    <TextBlock Grid.Column="2" Text="254" />
                                    <TextBlock Grid.Column="3" Text="C" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/25" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.128" />
                                    <TextBlock Grid.Column="2" Text="126" />
                                    <TextBlock Grid.Column="3" Text="" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/26" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.192" />
                                    <TextBlock Grid.Column="2" Text="62" />
                                    <TextBlock Grid.Column="3" Text="" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/27" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.224" />
                                    <TextBlock Grid.Column="2" Text="30" />
                                    <TextBlock Grid.Column="3" Text="" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/28" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.240" />
                                    <TextBlock Grid.Column="2" Text="14" />
                                    <TextBlock Grid.Column="3" Text="" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/29" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.248" />
                                    <TextBlock Grid.Column="2" Text="6" />
                                    <TextBlock Grid.Column="3" Text="" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/30" />
                                    <TextBlock Grid.Column="1" Text="255.255.255.252" />
                                    <TextBlock Grid.Column="2" Text="2" />
                                    <TextBlock Grid.Column="3" Text="Point-to-Point" />
                                </Grid>
                                <Grid Margin="0,2,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="170" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="/16" />
                                    <TextBlock Grid.Column="1" Text="255.255.0.0" />
                                    <TextBlock Grid.Column="2" Text="65,534" />
                                    <TextBlock Grid.Column="3" Text="B" />
                                </Grid>
                            </StackPanel>
                        </ui:Card>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 7: Network Scanner (Advanced IP Scanner style)        -->
            <!-- ============================================================ -->
            <TabItem Header="Network Scanner">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Subnet input + Adapter dropdown + Start/Stop -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="220" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:TextBox Grid.Column="0"
                                    PlaceholderText="Subnet (e.g. 192.168.1.0/24)"
                                    Text="{Binding ViewModel.ScanSubnet, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0" />
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding ViewModel.ScanAdapters}"
                                  DisplayMemberPath="Name"
                                  Margin="0,0,8,0" />
                        <ui:Button Grid.Column="2"
                                   Content="Detect"
                                   Command="{Binding ViewModel.LoadScanAdaptersCommand}"
                                   Margin="0,0,4,0" MinWidth="70" />
                        <ui:Button Grid.Column="3"
                                   Content="Start Scan"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.StartScanCommand}"
                                   Margin="0,0,4,0" MinWidth="90" />
                        <ui:Button Grid.Column="4"
                                   Content="Stop"
                                   Appearance="Danger"
                                   Command="{Binding ViewModel.StopScanCommand}"
                                   MinWidth="70" />
                    </Grid>

                    <!-- Stats bar -->
                    <ui:Card Grid.Row="1" Padding="12" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock Text="Scanned" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.ScannedCount}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                            </StackPanel>
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="Online" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.OnlineCount}"
                                           FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center"
                                           Foreground="#7DBF8E" />
                            </StackPanel>
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock Text="Status" Opacity="0.6" HorizontalAlignment="Center" />
                                <TextBlock Text="{Binding ViewModel.ScanStatus}"
                                           FontSize="12" HorizontalAlignment="Center"
                                           TextTrimming="CharacterEllipsis" MaxWidth="300" />
                            </StackPanel>
                        </Grid>
                    </ui:Card>

                    <!-- Filter + Copy IP -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,8">
                        <CheckBox Content="Show online only"
                                  IsChecked="{Binding ViewModel.ShowOnlineOnly}"
                                  VerticalAlignment="Center" Margin="0,0,16,0" />
                        <ui:Button Content="Copy IP"
                                   Command="{Binding ViewModel.CopyDeviceIpCommand}"
                                   MinWidth="80" />
                    </StackPanel>

                    <!-- Scanned devices table -->
                    <DataGrid Grid.Row="3"
                              ItemsSource="{Binding ViewModel.FilteredDevices}"
                              SelectedItem="{Binding ViewModel.SelectedDevice, Mode=TwoWay}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Status" Binding="{Binding StatusDisplay}" Width="70" />
                            <DataGridTextColumn Header="IP Address" Binding="{Binding IpAddress}" Width="130" />
                            <DataGridTextColumn Header="Hostname" Binding="{Binding Hostname}" Width="180" />
                            <DataGridTextColumn Header="MAC Address" Binding="{Binding MacAddress}" Width="150" />
                            <DataGridTextColumn Header="Manufacturer" Binding="{Binding Manufacturer}" Width="*" />
                            <DataGridTextColumn Header="Response" Binding="{Binding ResponseTimeDisplay}" Width="100" />
                        </DataGrid.Columns>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOnline}" Value="True">
                                        <Setter Property="Foreground" Value="#7DBF8E" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsOnline}" Value="False">
                                        <Setter Property="Foreground" Value="#888888" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 8: Wi-Fi (Scanner / Signal Monitor / Saved Profiles) -->
            <!-- ============================================================ -->
            <TabItem Header="Wi-Fi">
                <Grid Margin="16">
                    <TabControl SelectedIndex="{Binding ViewModel.WifiSubTabIndex}">

                        <!-- ================================================ -->
                        <!-- Wi-Fi Sub-tab 1: Network Scanner                 -->
                        <!-- ================================================ -->
                        <TabItem Header="Scanner">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <!-- Scan button + status -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <ui:Button Content="Scan"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.ScanWifiCommand}"
                                               MinWidth="80" Margin="0,0,16,0" />
                                    <TextBlock Text="{Binding ViewModel.WifiScanStatus}"
                                               VerticalAlignment="Center" Opacity="0.7" />
                                </StackPanel>

                                <!-- Channel usage chart -->
                                <ui:Card Grid.Row="1" Padding="12" Margin="0,0,0,12">
                                    <StackPanel>
                                        <TextBlock Text="Channel Usage" FontWeight="SemiBold" Margin="0,0,0,8" />
                                        <ItemsControl ItemsSource="{Binding ViewModel.ChannelUsage}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,2">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="55" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="80" />
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0"
                                                                   Text="{Binding Display}"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="11" />

                                                        <!-- Signal bar using ProgressBar -->
                                                        <ProgressBar Grid.Column="1"
                                                                     Value="{Binding StrongestSignal, Mode=OneWay}"
                                                                     Maximum="100"
                                                                     Height="16" Margin="4,0"
                                                                     Foreground="{Binding StrongestSignal, Converter={StaticResource SignalToBrush}}" />

                                                        <TextBlock Grid.Column="2"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="11" Opacity="0.7">
                                                            <Run Text="{Binding NetworkCount, Mode=OneWay}" />
                                                            <Run Text="AP(s)" />
                                                        </TextBlock>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </ui:Card>

                                <!-- Scanned networks table -->
                                <DataGrid Grid.Row="2"
                                          ItemsSource="{Binding ViewModel.WifiNetworks}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Signal" Binding="{Binding SignalDisplay}" Width="120" />
                                        <DataGridTextColumn Header="SSID" Binding="{Binding Ssid}" Width="180" />
                                        <DataGridTextColumn Header="Channel" Binding="{Binding Channel}" Width="70" />
                                        <DataGridTextColumn Header="Band" Binding="{Binding Band}" Width="70" />
                                        <DataGridTextColumn Header="Standard" Binding="{Binding WifiStandard}" Width="80" />
                                        <DataGridTextColumn Header="Security" Binding="{Binding Authentication}" Width="130" />
                                        <DataGridTextColumn Header="BSSID" Binding="{Binding Bssid}" Width="140" />
                                        <DataGridTextColumn Header="Quality" Binding="{Binding SignalQuality}" Width="80" />
                                    </DataGrid.Columns>

                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SignalQuality}" Value="Excellent">
                                                    <Setter Property="Foreground" Value="#7DBF8E" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SignalQuality}" Value="Good">
                                                    <Setter Property="Foreground" Value="#7DBF8E" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SignalQuality}" Value="Fair">
                                                    <Setter Property="Foreground" Value="#D4A843" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SignalQuality}" Value="Poor">
                                                    <Setter Property="Foreground" Value="#E06666" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SignalQuality}" Value="Very Poor">
                                                    <Setter Property="Foreground" Value="#E06666" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>
                                </DataGrid>
                            </Grid>
                        </TabItem>

                        <!-- ================================================ -->
                        <!-- Wi-Fi Sub-tab 2: Signal Monitor                  -->
                        <!-- ================================================ -->
                        <TabItem Header="Signal Monitor">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <!-- Controls -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <ui:Button Content="Start"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.StartSignalMonitorCommand}"
                                               Margin="0,0,4,0" MinWidth="80" />
                                    <ui:Button Content="Stop"
                                               Appearance="Danger"
                                               Command="{Binding ViewModel.StopSignalMonitorCommand}"
                                               Margin="0,0,16,0" MinWidth="80" />
                                    <TextBlock Text="Monitors signal strength of the connected network"
                                               VerticalAlignment="Center" Opacity="0.5" FontSize="12" />
                                </StackPanel>

                                <!-- Current stats card -->
                                <ui:Card Grid.Row="1" Padding="16" Margin="0,0,0,12">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                            <TextBlock Text="Network" Opacity="0.6" HorizontalAlignment="Center" />
                                            <TextBlock Text="{Binding ViewModel.MonitorSsid}"
                                                       FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                            <TextBlock Text="Signal" Opacity="0.6" HorizontalAlignment="Center" />
                                            <TextBlock Text="{Binding ViewModel.MonitorSignal, StringFormat={}{0}%}"
                                                       FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                            <TextBlock Text="Channel" Opacity="0.6" HorizontalAlignment="Center" />
                                            <TextBlock Text="{Binding ViewModel.MonitorChannel}"
                                                       FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                            <TextBlock Text="Link Speed" Opacity="0.6" HorizontalAlignment="Center" />
                                            <TextBlock Text="{Binding ViewModel.MonitorLinkSpeed}"
                                                       FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                        </StackPanel>
                                    </Grid>
                                </ui:Card>

                                <!-- Signal history chart (scrolling vertical bars) -->
                                <Border Grid.Row="2"
                                        Background="{DynamicResource ControlFillColorDefaultBrush}"
                                        CornerRadius="4" Padding="4">
                                    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                                  VerticalScrollBarVisibility="Disabled">
                                        <ItemsControl ItemsSource="{Binding ViewModel.SignalHistory}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Horizontal"
                                                                VerticalAlignment="Bottom" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Width="6" Margin="1,0"
                                                            VerticalAlignment="Bottom"
                                                            CornerRadius="2,2,0,0"
                                                            MinHeight="2"
                                                            Height="{Binding SignalPercent, Converter={StaticResource PercentToHeight}, ConverterParameter=250}"
                                                            Background="{Binding SignalPercent, Converter={StaticResource SignalToBrush}}"
                                                            ToolTip="{Binding TimeDisplay}" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </TabItem>

                        <!-- ================================================ -->
                        <!-- Wi-Fi Sub-tab 3: Saved Profiles                  -->
                        <!-- ================================================ -->
                        <TabItem Header="Saved Profiles">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <ui:Button Content="Load Wi-Fi Profiles"
                                               Appearance="Primary"
                                               Command="{Binding ViewModel.LoadWifiProfilesCommand}"
                                               MinWidth="150" Margin="0,0,16,0" />
                                    <TextBlock Text="Requires administrator privileges to retrieve passwords"
                                               VerticalAlignment="Center" Opacity="0.5" FontSize="12" />
                                </StackPanel>

                                <DataGrid Grid.Row="1"
                                          ItemsSource="{Binding ViewModel.WifiProfiles}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="SSID" Binding="{Binding Ssid}" Width="200" />
                                        <DataGridTextColumn Header="Security" Binding="{Binding SecurityType}" Width="180" />
                                        <DataGridTextColumn Header="Password" Binding="{Binding Password}" Width="*" />
                                        <DataGridTextColumn Header="Retrieved" Binding="{Binding PasswordRetrieved}" Width="100" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>

                    </TabControl>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 9: Active Connections (TCPView style)                   -->
            <!-- ============================================================ -->
            <TabItem Header="Connections">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Controls: Load/Refresh + Filter + Kill Process -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ui:Button Grid.Column="0"
                                   Content="Load Connections"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.LoadConnectionsCommand}"
                                   Margin="0,0,4,0" MinWidth="140" />
                        <ui:Button Grid.Column="1"
                                   Content="Refresh"
                                   Command="{Binding ViewModel.RefreshConnectionsCommand}"
                                   Margin="0,0,12,0" MinWidth="80" />
                        <ui:TextBox Grid.Column="2"
                                    PlaceholderText="Filter by process, address, port, state..."
                                    Text="{Binding ViewModel.ConnectionFilter, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,12,0" />
                        <ui:Button Grid.Column="3"
                                   Content="Kill Process"
                                   Appearance="Danger"
                                   Command="{Binding ViewModel.KillConnectionProcessCommand}"
                                   MinWidth="100" />
                    </Grid>

                    <!-- Active connections table -->
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding ViewModel.FilteredConnections}"
                              SelectedItem="{Binding ViewModel.SelectedConnection, Mode=TwoWay}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Protocol" Binding="{Binding Protocol}" Width="70" />
                            <DataGridTextColumn Header="Local Address" Binding="{Binding LocalAddress}" Width="140" />
                            <DataGridTextColumn Header="Local Port" Binding="{Binding LocalPort}" Width="90" />
                            <DataGridTextColumn Header="Remote Address" Binding="{Binding RemoteAddress}" Width="140" />
                            <DataGridTextColumn Header="Remote Port" Binding="{Binding RemotePort}" Width="90" />
                            <DataGridTextColumn Header="State" Binding="{Binding State}" Width="110" />
                            <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="60" />
                            <DataGridTextColumn Header="Process" Binding="{Binding ProcessName}" Width="*" />
                        </DataGrid.Columns>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow"
                                   BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding State}" Value="Established">
                                        <Setter Property="Foreground" Value="#7DBF8E" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State}" Value="Listen">
                                        <Setter Property="Foreground" Value="#6CA6D4" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State}" Value="TimeWait">
                                        <Setter Property="Foreground" Value="#D4A843" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding State}" Value="CloseWait">
                                        <Setter Property="Foreground" Value="#D4A843" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- ============================================================ -->
            <!-- TAB 10: Speed Test                                         -->
            <!-- ============================================================ -->
            <TabItem Header="Speed Test">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Run / Cancel buttons -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                        <ui:Button Content="Run Speed Test"
                                   Appearance="Primary"
                                   Command="{Binding ViewModel.RunSpeedTestCommand}"
                                   MinWidth="140" Margin="0,0,8,0" />
                        <ui:Button Content="Cancel"
                                   Appearance="Danger"
                                   Command="{Binding ViewModel.CancelSpeedTestCommand}"
                                   Visibility="{Binding ViewModel.IsTestingSpeed, Converter={StaticResource BoolToVis}}"
                                   MinWidth="80" Margin="0,0,16,0" />
                        <TextBlock Text="Tests download, upload, latency and jitter via Cloudflare"
                                   VerticalAlignment="Center" Opacity="0.5" FontSize="12" />
                    </StackPanel>

                    <!-- Progress bar + status text -->
                    <StackPanel Grid.Row="1" Margin="0,0,0,16"
                                Visibility="{Binding ViewModel.IsTestingSpeed, Converter={StaticResource BoolToVis}}">
                        <ProgressBar Value="{Binding ViewModel.SpeedTestPercent, Mode=OneWay}"
                                     Maximum="100" Height="20" Margin="0,0,0,8" />
                        <TextBlock Text="{Binding ViewModel.SpeedTestProgress}"
                                   Opacity="0.7" FontSize="13" />
                    </StackPanel>

                    <!-- Completion status (when not testing) -->
                    <TextBlock Grid.Row="1"
                               Text="{Binding ViewModel.SpeedTestProgress}"
                               Visibility="{Binding ViewModel.SpeedTestProgress, Converter={StaticResource StringToVis}}"
                               Opacity="0.7" Margin="0,0,0,16" />

                    <!-- Results card: 2x2 grid with large numbers -->
                    <ui:Card Grid.Row="2" Padding="24" Margin="0,0,0,16"
                             Visibility="{Binding ViewModel.HasSpeedResult, Converter={StaticResource BoolToVis}}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Download -->
                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock Text="Download" Opacity="0.6"
                                           HorizontalAlignment="Center" Margin="0,0,0,4" />
                                <TextBlock Text="{Binding ViewModel.SpeedTestDownload}"
                                           FontSize="28" FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           Foreground="#7DBF8E" />
                            </StackPanel>

                            <!-- Upload -->
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock Text="Upload" Opacity="0.6"
                                           HorizontalAlignment="Center" Margin="0,0,0,4" />
                                <TextBlock Text="{Binding ViewModel.SpeedTestUpload}"
                                           FontSize="28" FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           Foreground="#6CA6D4" />
                            </StackPanel>

                            <!-- Latency -->
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock Text="Latency" Opacity="0.6"
                                           HorizontalAlignment="Center" Margin="0,0,0,4" />
                                <TextBlock Text="{Binding ViewModel.SpeedTestLatency}"
                                           FontSize="28" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                            </StackPanel>

                            <!-- Jitter -->
                            <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                <TextBlock Text="Jitter" Opacity="0.6"
                                           HorizontalAlignment="Center" Margin="0,0,0,4" />
                                <TextBlock Text="{Binding ViewModel.SpeedTestJitter}"
                                           FontSize="28" FontWeight="Bold"
                                           HorizontalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </ui:Card>

                    <!-- Server info and timestamp -->
                    <StackPanel Grid.Row="3" VerticalAlignment="Top"
                                Visibility="{Binding ViewModel.HasSpeedResult, Converter={StaticResource BoolToVis}}">
                        <TextBlock Opacity="0.5" FontSize="12">
                            <Run Text="Server: " />
                            <Run Text="{Binding ViewModel.SpeedTestServer}" FontWeight="SemiBold" />
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </TabItem>

        </TabControl>

        <!-- Status bar -->
        <TextBlock Grid.Row="1"
                   Text="{Binding ViewModel.StatusText}"
                   Opacity="0.6"
                   FontSize="12"
                   Margin="0,8,0,0" />
    </Grid>
    </DockPanel>
</Page>
